!function(e,n){var t,o="appClient",r="appInvoke",i="appInvoke",a="appInvoke";if(!e.document)throw new Error("You are not in Browser or Webview environment.");"object"==typeof e[o]&&"function"==typeof e[o][r]?(t=e[o])[a]&&t[a]===e[o][r]||(t[a]=e[o][r]):(t={})[a]=function(n){if(!e[i])throw new Error("You are not in App environment.");return e[i](n)},e.JSBridge=function(e,n){function t(e){var n=!1,t=[];return o.add(e,function(){if(n=!0,t&&t.length)for(var e=0;e<t.length;e++)t[e]()}),function(e){t.push(e),n&&e()}}var o,r,i,a,c;o=function(){var e={};return{add:function(n,t){if(!n)throw new Error("Global function name is empty.");if("function"!=typeof t)throw new Error("Global function must be a function");if(e[n])throw new Error("Global function name("+n+") is already used. Global function name muse be unique.");e[n]=t},get:function(n){return e[n]},clear:function(){e={}}}}(),r=function(){var e={};return{add:function(n,t){if(!n||!t)throw new Error("Handler can not be null.");if("string"==typeof t&&!o(t))throw new Eorror("Handler ["+t+"] is not defined in gloabal functions.");if(void 0!==e[n])throw new Error("Your requestId("+n+") is already used,requestId must be unique.");e[n]=t},get:function(n){var t=e[n];if(!t)return;delete e[n],"string"==typeof t&&(t=o.get(t));return t},clear:function(){e={}}}}(),e.JSCallback=function(){function e(e){var n,t,i,a,s,u="error";if("string"==typeof e&&(e=JSON.parse(e)),!(n=function(e,n){var t;if(!e)return void console.warn("Invalid callback, Result must have a mtehod field.");if("callback"!==e)return(t=o.get(e))||console.warn("Missing callback, Can not find handler with '"+e+"' in gloabal functions."),t;if(!n)return void console.warn("Invalid callback, 'requestId' must be not empty when method is 'callback'.");if(!(t=r.get(n)))return void console.warn("Missing callback, Can not find handler with '"+n+"'.");return t}(e.method,e.requestId))){if(!c.has(e.method))return;n=function(n){c.dispatch(e.method,n)}}if(e.data)try{if("string"==typeof(t=e.data)&&(t=JSON.parse(t)),t.status||"callback"!=e.method)u="success",i=t.data;else if(i={status:t.status,message:t.message,httpCode:t.code_http,errorCode:t.code_system},(s=o.get("netErrorEvent"))&&!1===s(i))return void r.clear()}catch(e){console.warn("Invalid result body."+e.stack)}else console.log("Empty result body.");if("function"!=typeof n)return"object"==typeof n?("function"==typeof n[u]?n[u](i):"string"==typeof n[u]?"function"==typeof(a=o.get(n[u]))?a(i):console.warn("Missing callback, Can not find function '"+n[u]+"' in global callbacks: "+JSON.stringify(n)):console.warn("Missing callback, Handler do not have method '"+u+"'. handler: "+JSON.stringify(n)),void(n.complete&&n.complete())):void 0;n(t)}return function(n){n?e(n):console.warn("Empty callback result, Something wrong in app?")}}(),a=function(){var e=0;return function(n){return(n||"anonymous")+"_"+Date.now()+"_"+ ++e}}(),i=function(e){var t,i,c,s,u,l;if(!e)throw new Error("Invoke argument settings can not be empty.");if("string"!=typeof e.type||-1==e.type.indexOf("."))throw new Error("Invoke argument type is not valid.");i=a(e.type),c=e.type.split("."),(s=o.get("invoke"))&&s(e),(u=o.get("invoke."+c[0]))&&u(e),(l=o.get("invoke."+e.type))&&l(e),(e.success||e.error||e.complete)&&r.add(i,{success:e.success,error:e.error,complete:e.complete}),t=JSON.stringify({requestId:i,service:c[0],method:c[1],data:e.data});try{return n.appInvoke(t)}catch(n){console.error("AppInvoke has some problem."+n.stack),e.error&&e.error(n),e.complete&&e.complete()}};return c=function(){function e(e,t,o){if(!e)throw new Error("Event name is require.");if(!t)throw new Error("Event callback is require.");o||(o=1/0),n[e]||(n[e]=[]),n[e].push({callback:t,triggedTimes:0,lifeTimes:o})}var n={};return{on:e,one:function(n,t){e(n,t,1)},clear:function(){n={}},remove:function(e,t){var o,r=n[e];r&&(t?-1!=(o=r.indexOf(t))&&r.splice(o,1):delete n[e])},has:function(e,t){var o=n[e];return t?o.includes(t):o&&o.length},dispatch:function(e,t){var o=n[e],r=!0,i=[];if(o&&o.length)return o.forEach(function(e,n){e.triggedTimes>=e.lifeTimes||(r=!(!1===e.callback(t))&&r,e.triggedTimes++,e.triggedTimes<e.lifeTimes&&i.push(n))}),i.length?n[e]=i.map(function(e,n){return o[e]}):delete n[e],r}}}(),{invoke:i,registerFunction:o.add.bind(o),loadFinish:t("loadFinish"),onReady:t("onReady"),event:c,on:c.on.bind(c),one:c.one.bind(c),dispatch:c.dispatch.bind(c)}}(e,t),"object"!=typeof module||"object"!=typeof module.exports?e.onBridgeFinished&&e.onBridgeFinished(e.JSBridge):module.exports={JSBridge:e.JSBridge}}("undefined"!=typeof window?window:this);