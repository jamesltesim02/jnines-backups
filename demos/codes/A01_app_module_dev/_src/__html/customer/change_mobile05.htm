<template id="contentTmpl">
<div class="main_content">
    <section class="modifymobile_content _04">
        <div class="layout_form">
            <form action="" method="post">   
                <p>请输入{{mixedPhone}}的完整号码</p>         
                <div class="form_field_wrap">
                    <div class="form_field">
                        <span class="label">原手机号码</span>      
                        <div class="input_wrap"><input class="txt_right" type="text" maxlength="11" v-model="phoneInput"></div>
                    </div>  
                </div>
                <p v-if="bankBinded">请输入{{mixedBankCardNo}}的完整银行卡号</p>
                <p v-else>请先 <a href="#" v-on:click.stop.prevent="bind_bank" style="color: #039de7;text-decoration: underline;">绑定银行卡</a></p>
                <div class="form_field_wrap">
                    <div class="form_field">
                        <span class="label">原银行号码</span>      
                        <div class="input_wrap"><input class="txt_right" type="text" v-model="bankCardNoInput"></div>
                    </div>  
                </div>
                <div class="form_btn-wrap">
                    <a v-on:click.stop.prevent="go_change" href="#" class="btn btn-lg btn-ylw">下一步</a>
                </div>
            </form>
        </div>
    </section>
</div>
</template>
<script>
;(function(){
	appState.setData({
	    needLogin: true,
	    title: '重新绑定'
	});
	var vueData={
	    phone: '',
	mixedPhone: '',
	bankCardNo: '',
	mixedBankCardNo: '',
	phoneInput: '',
	bankCardNoInput: '',
	    bankBinded: false
	};
	Vue.component("app-content", {
	template: "#contentTmpl",
	data: function () {
		return  vueData
	},
	beforeMount: function () {
	},
	methods: {
	    go_change: function() {
	        if (!this.phoneInput || !this.bankCardNoInput) {
	            $.toast.fail('请输入手机号和银行卡号');
	            return;
	        }
	        if (this.phoneInput == this.phone && this.bankCardNoInput == this.bankCardNo) {
	            //最好是发送ajax验证，并且保存变量，防止url直接输入
	            JSBridge.forward.inside({url: "customer/change_mobile06.htm", newView: true});
	        } else {
	            $.toast.fail('手机号或银行卡号不对');
	        }
	    },
	    bind_bank: function() {
	        JSBridge.forward.inside({url: "customer/bank_list.htm", newView: true});
	        }
	    }
	});

	JSBridge.onReady(function() {
	    var _this = vueData;
        _this.phone = JSBridge.cache.get("customer").phone;
        _this.mixedPhone = OtherUtils.mixPhone(_this.phone);
        JSBridge.net.invoke({
            url: "bankcard/getList",
            success: function (result) {
                if (result.length > 0) {
                    var bankInfo = result[0];
                    _this.bankCardNo = bankInfo.bank_account_no;
                    _this.mixedBankCardNo = OtherUtils.mixBankCardNo(bankInfo.bank_account_no);
                    _this.bankBinded = true;
                } else {
                    _this.bankBinded = false;
                }
            }
        });
	});
})();
</script>