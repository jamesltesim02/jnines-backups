<template id="contentTmpl">
    <div class="main_content">
        <div class="changepass_content">
            <div class="nav-tab">
                <a class="tab-item active">登录密码 <span class="icon icon90"></span></a>
                <a forward="forward" newview="true" href="customer/change_pt_passwd.htm" class="tab-item">PT客户端密码<span class="icon icon90"></span></a>
            </div>  
            <div class="layout_form">
                <form action="" method="post">            
                    <div class="form_field_wrap">
                        <div class="form_field">
                            <span class="label">登录密码</span>      
                            <div class="input_wrap txt_right">
                                <input v-show="!oldPassVisible" v-model.trim="oldpassword" type="password" placeholder="当前账号密码" maxlength="10" />
                                <input v-show="oldPassVisible" v-model.trim="oldpassword" type="text" placeholder="当前账号密码" maxlength="10" />
                                <span @click="oldPassVisible = !oldPassVisible" :class="{icon_e:true,icon_ceye:true,icon_eye: oldPassVisible}" ></span>
                            </div>
                        </div>  
                        <div class="form_field">
                            <span class="label">新密码</span>      
                            <div class="input_wrap txt_right">
                                <input v-show="!passVisible" v-model.trim="password" type="password" placeholder="8-10字母和数字组合" maxlength="10" />
                                <input v-show="passVisible" v-model.trim="password" type="text" placeholder="8-10字母和数字组合" maxlength="10" />
                                <span @click="togglePass" :class="{icon_e:true,icon_ceye:true,icon_eye: passVisible}" ></span>
                            </div>
                        </div>  
                    </div>
                    <div class="form_btn-wrap">
                        <a id="submitButton" @click="updatePwd" class="btn btn-lg btn-ylw">确定 </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</template>

<script>
appState.setData({
    needLogin: true,
    title: '修改密码',
});
Vue.component("app-content", {
    template: "#contentTmpl",
    data: function () {
        return {
            passVisible: false,
            oldPassVisible: false,
            password: '',
            oldpassword: ''
        };
    },
    methods: {
        togglePass: function () {
            this.passVisible = !this.passVisible;
        },
        updatePwd: function () {
            var _this = this;
            if (!_this.oldpassword) {
                $.toast.fail("登录密码不能为空");
                return;
            }

            if (!_this.password) {
                $.toast.fail("新密码不能为空");
                return;
            }
            
            if (_this.oldpassword == _this.password) {
            	$.toast.fail("两个密码不可一样");
            	return;
            }

            if(!/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9a-zA-Z]{8,10}$/.test(_this.password)) {
                $.toast.fail("新密码必须是8-10字母和数字组合");
                return;
            }

            JSBridge.net.invoke({
                url: "users/updatePassword",
                data: {
                    'oldpwd':_this.oldpassword,
                    'pwd':_this.password
                },
                success: function (result) {
                	$.toast.success("修改成功", function(){
                        JSBridge.forward.inside({url: 'customer/member_center.htm'});
                    }); 
                },
                error: function (error) {
                    $.toast.fail("修改失败:" + error.message);
                }
            });
        }
    }
});
</script>