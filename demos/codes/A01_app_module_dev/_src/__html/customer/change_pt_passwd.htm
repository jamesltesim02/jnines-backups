<template id="contentTmpl">
    <div class="main_content">
        <div class="changepass_content">
            <div class="nav-tab">
                <a forward="forward" newview="true" href="customer/change_password.htm" class="tab-item">登录密码 <span class="icon icon90"></span></a>
                <a class="tab-item active">PT客户端密码<span class="icon icon90"></span></a>
            </div>  
            <div class="layout_form">
                <form action="" method="post">            
                    <div class="form_field_wrap">
                        <div class="form_field">
                            <span class="label">登录密码</span>      
                            <div class="input_wrap txt_right">
                                <input v-show="!passVisible" class="input1" type="password" v-model="pwd" maxlength="10" placeholder="当前账号密码">
                                <input v-show="passVisible" class="input1" type="text" v-model="pwd" maxlength="10" placeholder="当前账号密码">
                                <span @click="passVisible = !passVisible" :class="{icon_e:true,icon_ceye:true,icon_eye: passVisible}" ></span>
                            </div>
                        </div>  
                        <div class="form_field">
                            <span class="label">新密码</span>      
                            <div class="input_wrap txt_right">
                                <input v-show="!ptPassVisible" v-model="pt_key" type="password" placeholder="6~12位数字和字母组合">
                                <input v-show="ptPassVisible" v-model="pt_key" type="text" placeholder="6~12位数字和字母组合">
                                <span @click="ptPassVisible = !ptPassVisible" :class="{icon_e:true,icon_ceye:true,icon_eye: ptPassVisible}" ></span>
                            </div>
                        </div>  
                    </div>
                    <div class="form_btn-wrap">
                        <a id="submitButton" @click="updatePwd" class="btn btn-lg btn-ylw">确定 </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</template>


<script>
appState.setData({
    title: '修改PT密码',
    needLogin: true
});
Vue.component("app-content", {
    template: "#contentTmpl",
    data: function () {
        return {
            passVisible: false,
            ptPassVisible: false,
            pwd: '',
            pt_key: ''
        };
    },
    methods: {
        updatePwd: function () {
            var _this = this;

            if (!_this.pwd) {
                $.toast.fail("登录密码不能为空");
                return;
            }

            if (!_this.pt_key) {
                $.toast.fail("PT密码不能为空");
                return;
            }

            if(!/^.*([a-zA-Z]+\d+)|(\d+[a-zA-Z]+).*$/.test(_this.pt_key) || _this.pt_key.length < 6 || _this.pt_key.length > 10) {
                $.toast.fail("PT密码必须是6~12位,并同时包含数字和字母的组合");
                return ;
            }

            JSBridge.net.invoke({
                url: "users/updatePTPwd",
                data: {
                    'pwd':_this.pwd,
                    'pt_key':_this.pt_key
                },
                success: function (result) {
                    $.toast.success("修改成功", function(){
                        JSBridge.forward.inside({url: 'customer/member_center.htm'});
                    }); 
                },
                error: function (error) {
                    $.toast.fail("修改失败:" + error.message);
                }
            });
        }
    }
});
</script>